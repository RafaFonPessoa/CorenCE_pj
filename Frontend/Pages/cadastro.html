<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../styles/images/coren-ce_favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="../styles/login_cadastro_style.css">
    <title>Pagina de Cadastro</title>
</head>
<body>
    <div class="main-block">
        <div class="page-top">
            <img id="logo-coren" alt="logo-coren-ce" src="../styles/images/coren-ce_logo.png">
            <h1>Cadastro de Usuário</h1>
            <h4>Preencha os campos para cadastrar um usuário!</h4>
        </div>
      
        <div class="form-position">
            <form id="registerForm" class="input-group" method="post">
                <label class="label">Usuário</label>
                <input id="user-input" autocomplete="off" name="user" class="input" type="text">
                <label class="label">Senha</label>
                <input id="password-input" autocomplete="off" name="password" class="input" type="password">
                <label class="label">Confirme a Senha</label>
                <input id="confpass-input" autocomplete="off" name="confpass" class="input" type="password">
                <button id="btn-submit" type="submit">
                    <span id="btn-text">Cadastrar</span>
                </button>
            </form>
        </div>
        <footer>
            <p>© 2023 Coren-ce</p>
        </footer>
    </div>

    <!-- Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    
     <script>
         // Adicione um evento de submit ao formulário
         document.getElementById("registerForm").addEventListener("submit", function (event) {
             event.preventDefault(); // Evita o comportamento padrão do formulário
 
             // Obtém os valores do formulário
             const user = document.getElementById("user-input").value.trim();
             const password = document.getElementById("password-input").value.trim();
             const confpass = document.getElementById("confpass-input").value.trim();
 
             // Faz a validação no frontend (opcional)
             if (user === "" || password === "" || confpass === "") {
                 alert("Por favor, preencha todos os campos!");
                 return;
             }
 
             if (password !== confpass) {
                 alert("As senhas estão diferentes! Tente novamente!");
                 return;
             }
 
             // Faz a requisição POST para a API backend
             axios.post("http://localhost:5500/api/signup", { username: user, password: password })
                 .then(response => {
                     // Se o cadastro foi bem-sucedido, redireciona para a tela de login
                     alert("Usuário cadastrado com sucesso!");
                     window.location.href = "login.html";
                 })
                 .catch(error => {
                     // Se houve um erro no cadastro, exibe uma mensagem de erro
                    if (error.response && error.response.status === 409) {
                        alert("Usuário já está registrado. Por favor, use outro usuário.");
                    } else {
                        alert("Ocorreu um erro ao cadastrar o usuário. Tente novamente.");
                    }
                 });
         });
     </script>
</body>
</html>